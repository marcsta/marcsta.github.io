function toggleDateInput(e){"picker"==e?($("#date-buttons").addClass("dn"),$("#date-picker").removeClass("dn")):($("#date-buttons").removeClass("dn"),$("#date-picker").addClass("dn"),$("#letter_pick_date_1").prop("checked","true"))}function setLetterHeight(){if($("#letter_body").size()>0){var e=$("#letter_body").height(),t=window.innerHeight-$("#new_letter").height()-2*$("#new_letter").offset().top;$("#letter_body").css("min-height",e+t)}}!function(e,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var o={exports:{}};t(o.exports,o),e.autosize=o.exports}}(this,function(e,t){"use strict";function o(e){function t(){var t=window.getComputedStyle(e,null);"vertical"===t.resize?e.style.resize="none":"both"===t.resize&&(e.style.resize="horizontal"),s="content-box"===t.boxSizing?-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(s)&&(s=0),r()}function o(t){var o=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=o,e.style.overflowY=t}function n(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}function i(){var t=e.style.height,o=n(e),i=document.documentElement&&document.documentElement.scrollTop;e.style.height="";var r=e.scrollHeight+s;0!==e.scrollHeight?(e.style.height=r+"px",d=e.clientWidth,o.forEach(function(e){e.node.scrollTop=e.scrollTop}),i&&(document.documentElement.scrollTop=i)):e.style.height=t}function r(){i();var t=Math.round(parseFloat(e.style.height)),n=window.getComputedStyle(e,null),r="content-box"===n.boxSizing?Math.round(parseFloat(n.height)):e.offsetHeight;if(r!==t?"hidden"===n.overflowY&&(o("scroll"),i(),r="content-box"===n.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight):"hidden"!==n.overflowY&&(o("hidden"),i(),r="content-box"===n.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight),u!==r){u=r;var s=a("autosize:resized");try{e.dispatchEvent(s)}catch(l){}}}if(e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!l.has(e)){var s=null,d=e.clientWidth,u=null,c=function(){e.clientWidth!==d&&r()},h=function(t){window.removeEventListener("resize",c,!1),e.removeEventListener("input",r,!1),e.removeEventListener("keyup",r,!1),e.removeEventListener("autosize:destroy",h,!1),e.removeEventListener("autosize:update",r,!1),Object.keys(t).forEach(function(o){e.style[o]=t[o]}),l["delete"](e)}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",h,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",r,!1),window.addEventListener("resize",c,!1),e.addEventListener("input",r,!1),e.addEventListener("autosize:update",r,!1),e.style.overflowX="hidden",e.style.wordWrap="break-word",l.set(e,{destroy:h,update:r}),t()}}function n(e){var t=l.get(e);t&&t.destroy()}function i(e){var t=l.get(e);t&&t.update()}var r,s,l="function"==typeof Map?new Map:(r=[],s=[],{has:function(e){return r.indexOf(e)>-1},get:function(e){return s[r.indexOf(e)]},set:function(e,t){-1===r.indexOf(e)&&(r.push(e),s.push(t))},"delete":function(e){var t=r.indexOf(e);t>-1&&(r.splice(t,1),s.splice(t,1))}}),a=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(u){a=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}var d=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((d=function(e){return e}).destroy=function(e){return e},d.update=function(e){return e}):((d=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],function(e){return o(e,t)}),e}).destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],n),e},d.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],i),e}),t.exports=d}),window.webcam={version:"1.1.0",ie:!!navigator.userAgent.match(/MSIE/),protocol:location.protocol.match(/https/i)?"https":"http",callback:null,loaded:!1,quality:95,shutter_sound:!0,hooks:{onLoad:null,onComplete:"upload_complete",onError:null},set_hook:function(e,t){if("undefined"==typeof this.hooks[e])return alert("Hook type not supported: "+e);this.hooks[e]=t},fire_hook:function(e,t){return!!this.hooks[e]&&("function"==typeof this.hooks[e]?this.hooks[e](t):"array"==typeof this.hooks[e]?this.hooks[e][0][this.hooks[e][1]](t):window[this.hooks[e]]&&window[this.hooks[e]](t),!0)},set_api_url:function(e){this.api_url=e},set_swf_url:function(e){this.swf_url=e},get_html:function(e,t,o,n){o||(o=e),n||(n=t);var i="",r="shutter_enabled="+(this.shutter_sound?1:0)+"&shutter_url="+escape(this.shutter_url)+"&width="+e+"&height="+t+"&server_width="+o+"&server_height="+n;return this.ie?i+="not supporter":i+='<embed id="webcam_movie" src="'+this.swf_url+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="webcam_movie" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+r+'" />',this.loaded=!1,i},get_movie:function(){if(!this.loaded)return alert("ERROR: Movie is not loaded yet");var e=document.getElementById("webcam_movie");return e||alert("ERROR: Cannot locate movie 'webcam_movie' in DOM"),e},snap:function(e,t){t&&this.set_hook("onComplete",t),e&&this.set_api_url(e),this.get_movie()._snap(this.api_url,this.quality,this.shutter_sound?1:0)},freeze:function(){this.get_movie()._snap("",this.quality,this.shutter_sound?1:0)},upload:function(e,t){t&&this.set_hook("onComplete",t),e&&this.set_api_url(e),this.get_movie()._upload(this.api_url)},dump:function(e){e&&this.set_hook("onComplete",e),this.get_movie()._dump()},reset:function(){this.get_movie()._reset()},configure:function(e){e||(e="camera"),this.get_movie()._configure(e)},set_quality:function(e){this.quality=e},set_shutter_sound:function(e,t){this.shutter_sound=e,this.shutter_url=t||"/images/shutter.mp3"},flash_notify:function(e,t){switch(e){case"flashLoadComplete":this.loaded=!0,this.fire_hook("onLoad");break;case"error":this.fire_hook("onError",t)||alert("JPEGCam Flash Error: "+t);break;case"success":this.fire_hook("onComplete",t.toString());break;default:alert("jpegcam flash_notify: "+e+": "+t)}}};var letter={getEmail:function(){var e=$("#letter_email").val().trim();return"Enter your email"===e||"Your email"===e?"":e},getDeliveryDate:function(){if($("#letter_pick_date_1").attr("checked")){var e=$("#date-picker #letter_send_date_1i").val(),t=parseInt($("#date-picker #letter_send_date_2i").val())-1,o=$("#date-picker #letter_send_date_3i").val();return moment([e,t,o])}if($("#letter_pick_date_1").attr("checked"))return moment().add(1,"years")},buildDeliveryMsg:function(){var e=letter.getDeliveryDate(),t=e.diff(moment(),"days"),o=e.format("MMMM, DD, YYYY"),n=letter.getEmail(),i="Your letter will be delivered ";return n&&(i+="to "+n),i+" in "+t+" days on "+o+"!"},insertDeliveryMessage:function(){$("#letter-delivery-info").html(letter.buildDeliveryMsg())}};$(document).ready(function(){if($(".parsley").size()>0&&($(".parsley").parsley().on("field:success",function(){this.$element.siblings(".invalid-icon").addClass("dn"),this.$element.siblings(".valid-icon").removeClass("dn"),this.$element.closest("form").find("input[type=submit]").prop("disabled",!1)}),$(".parsley").parsley().on("field:error",function(){this.$element.siblings(".invalid-icon").removeClass("dn"),this.$element.siblings(".valid-icon").addClass("dn"),this.$element.closest("form").find("input[type=submit]").prop("disabled",!0)})),$(".date-button").click(function(){var e=(new Date).getFullYear()+parseInt($(this).val());$("#letter_send_date_1i").val(e).change()}),$("#letter_email").focusin(function(){$(this).attr("value","")}),$("#letter_email").focusout(function(){""==$(this).attr("value")&&$(this).attr("value","Your email")}),$("textarea[data-autosize]").size()>0&&autosize(document.querySelector("textarea[data-autosize]")),$("#letter_body").size()>0){window.addEventListener("resize",setLetterHeight),setLetterHeight();var e=$("#letter_body"),t=e.val().length;e.focus(),e[0].setSelectionRange(t,t),document.getElementById("letter_body").addEventListener("blur",function(){document.getElementById("letter_body").value.length>12?(localStorage.setItem("letterdraft",document.getElementById("letter_body").value),console.log("letter draft saved")):localStorage.removeItem("letterdraft")},!1),document.getElementById("send_to_the_future").addEventListener("click",function(){localStorage.removeItem("letterdraft")},!0),null!=localStorage.getItem("letterdraft")&&(document.getElementById("letter_body").value=localStorage.getItem("letterdraft"))}});